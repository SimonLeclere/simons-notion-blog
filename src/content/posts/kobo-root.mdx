---
title: "Jailbreak de la liseuse Kobo Aura 2"
date: "2024-02-14"
excerpt: "Transformer une liseuse Kobo Aura 2 en station mÃ©tÃ©o connectÃ©e et personnalisÃ©e avec YAWK et une API Next.js."
image: "/images/kobo-root/kobo-weather-min.png"
icon: "ğŸ“š"
author: "SimonLeclere"
authorName: "Simon Leclere"
---

Ã‰tant un lecteur occasionnel (et un gros geek), on mâ€™a offert il y a quelques annÃ©es (en 2016 !) une liseuse afin de pouvoir me balader avec quelques centaines de livres dans un tout petit appareil de mÃªme pas 200g. Je suis retombÃ© dessus rÃ©cemment et, ne lâ€™utilisant plus si souvent, jâ€™ai eu envie dâ€™en faire quelque-chose.

Quelques recherches plus tard, je me rends compte que je ne suis pas le premier Ã  avoir eu ce genre dâ€™idÃ©es, et quâ€™il existe sur certains forums des communautÃ©s entiÃ¨res dÃ©diÃ©es Ã  la modification de liseuses.

Lâ€™objectif est donc de jailbreak ma liseuse Kobo afin dâ€™en faire une petite station mÃ©tÃ©o. Ce projet est directement inspirÃ© des projets de KevinShort et Matthew Petroff :

<Columns>
  <Figure 
    src="/images/kobo-root/kobo-wifi-weather.png" 
    caption="Kevin Short's Kobo Wifi Weather Forecast" 
  />
  <Figure 
    src="/images/kobo-root/kindle-weather-display.png" 
    caption="Matthew Petroff's Kindle weather display" 
  />
</Columns>

Sur les modÃ¨les ci-dessus, je trouve personnellement quâ€™il y a un peu trop dâ€™informations. Quand je regarde la mÃ©tÃ©o au quotidien je regarde surtout la mÃ©tÃ©o pour le jour mÃªme, et Ã  la rigueur les tempÃ©ratures des jours suivants. On pourra donc viser une interface plus simple, et faire un peu de place pour un petit ajout personnel (vous verrez !).

# 1. Installation de YAWK

HonnÃªtement, en commencant ce projet je nâ€™avais absolument aucune idÃ©e de comment faire. Je ne savais pas comment fonctionnait une liseuse kobo, quels composants il y avait dedans, est-ce que ca utilise un OS propriÃ©taire ou une distribution lÃ©gÃ¨re de linux, â€¦

En faisant quelques recherches, je suis tombÃ© sur [YAWK](https://github.com/brunolalb/yawk/), un projet ressemblant beaucoup Ã  ce que je voulais faire mais beaucoup plus rÃ©cent que les projets prÃ©sentÃ©s prÃ©cÃ©demment !

La premiÃ¨re Ã©tape Ã©vidente est donc de lâ€™installer, comme ca je saurais si les techniques utilisÃ©es fonctionnent sur mon modÃ¨le de liseuse. Pour ca, la documentation de YAWK est plutÃ´t claire, je vais rÃ©sumer rapidement le processus.

### 1. RÃ©initialiser la liseuse aux paramÃ¨tres dâ€™usine.
Cette Ã©tape est optionnelle mais elle permet de partir sur une base saine et surtout de sâ€™assurer que la liseuse aura assez dâ€™espace de stockage pour la suite. Si vous avez des ebooks que vous souhaitez garder pensez Ã  faire une sauvegarde avant !

### 2. Installer [NiLuJe's Stuff](https://www.mobileread.com/forums/showthread.php?t=254214) sur la liseuse
NiLuJe est un acteur important du modding de liseuses et est trÃ¨s actif sur le site [MobileRead](https://www.mobileread.com/). Il a notamment dÃ©veloppÃ© [FbInk](https://github.com/NiLuJe/FBInk), un outil permettant de dessiner des formes et du texte simplement sur des Ã©crans Ã  encre, et a publiÃ© plusieurs tutoriels pour jailbreak des liseuses kobo et kindle.

Ici, je vais utiliser un package dâ€™outils nommÃ© â€œKobo-stuffâ€ quâ€™il a crÃ©Ã© pour modder simplement des liseuses Kobo.

Des liens Ã  jour du package peuvent Ãªtre trouvÃ©s dans ce thread :

<Bookmark 
  title="Aura H2O Yet another telnet/sshd & misc tools package... - MobileRead Forums"
  description="Kobo Developer's Corner - Tutorials and tools for modding Kobo e-readers."
  url="https://www.mobileread.com/forums/showthread.php?t=254214"
  image="https://www.mobileread.com/forums/images/misc/mobile_read_logo_v2.png"
/>

Pour lâ€™installer sur la liseuse, rien de plus simple ! Il se trouve que le fonctionnement des liseuses kobo est un peu bÃªte : au lancement, si un dossier compressÃ© nommÃ© `KoboRoot.tgz` est prÃ©sent Ã  la racine de la liseuse, alors un processus dâ€™update se lance.

Si tout se passe bien, la liseuse redÃ©marre normalement et rien ne semble avoir changÃ©.

### 3. Installation de YAWK
Pour cette Ã©tape il est nÃ©cessaire dâ€™avoir un client FTP comme Filezilla et un client Telnet.

Je commence par connecter la liseuse au mÃªme wifi que mon pc, puis je rÃ©cupÃ¨re lâ€™adresse IP de ma liseuse dans **paramÃ¨tres > Informations sur lâ€™appareil > Adresse IP**.

Si lâ€™Ã©tape 2 sâ€™est bien passÃ©e, on devrait pouvoir se connecter Ã  la liseuse Ã  distance. Avec Filezilla, je crÃ©e un rÃ©pertoire `.apps/yawk` et je copie tout le contenu du repo de YAWK dedans.

<Callout type="warning">
  **Attention !** Si vous Ãªtes sous Windows, vos fichiers ont probablement des fins de ligne au format CRLF, hors Linux ne supporte que les fins de lignes LF. Avant de copier les fichiers, je les ai convertis avec lâ€™outil dos2unix.
</Callout>

Ensuite jâ€™ouvre une session telnet avec lâ€™ip rÃ©cupÃ©rÃ©e prÃ©cÃ©demment et je tape les commandes suivantes :

*   `tmux new -s kobo update-kobostuff Python` pour installer python3
*   `cd /mnt/onboard/.apps/yawk` pour naviguer jusquâ€™au rÃ©pertoire de YAWK
*   `sh install.sh` pour lancer le script dâ€™installation de YAWK

Le script dâ€™installation demande une clÃ© dâ€™api [OpenWeatherMap](https://openweathermap.org/) et lâ€™id de la ville dont on souhaite surveiller la mÃ©tÃ©o.

<Bookmark 
  title="Current weather and forecast - OpenWeatherMap"
  description="Access global weather data, including current, forecast, and historical information via clean APIs."
  url="https://openweathermap.org/"
  image="https://openweathermap.org/themes/openweathermap/assets/img/logo_white_cropped.png"
/>

A la fin du script, la liseuse redÃ©marre etâ€¦

<Figure 
  src="/images/kobo-root/test-result.png" 
  caption="Premier test concluant : l'interface s'affiche correctement sur la liseuse."
  width="70%"
  align="center"
/>

Tout fonctionne !

# 2. Personnalisation de lâ€™interface

Maintenant que je sais quâ€™il est possible dâ€™afficher du contenu arbitraire sur lâ€™Ã©cran de ma liseuse et que je sais plus ou moins comment le faire, je peux expÃ©rimenter un peu et implÃ©menter mes propres features :)

Pour commencer, je vais rÃ©duire un peu la quantitÃ© dâ€™informations affichÃ©e Ã  lâ€™Ã©cran. Pour ca, je modifie les fichiers `weather.py` et `yawk.py` et jâ€™arrive rapidement Ã  un rÃ©sultat satisfaisant :

<Figure 
  src="/images/kobo-root/kobo-weather-min.png" 
  caption="Au lieu dâ€™afficher les prÃ©dictions mÃ©tÃ©o sur 5 jours, jâ€™affiche maintenant des infos dÃ©taillÃ©es pour la mÃ©tÃ©o du jour, et seulement la tempÃ©rature et lâ€™icÃ´ne indiquant le temps pour les 3 prochains jours." 
  width="70%"
  align="center"
/>

Les plus malins auront remarquÃ© le grand espace vide en bas de lâ€™Ã©cran. Cette place pourrait me servir Ã  loger un gros widget pour afficher Ã  peu prÃ¨s nâ€™importe quoi. Jâ€™ai plusieurs idÃ©es dâ€™ailleurs :

*   **Ã‰tat de ma domotique** : quelles lumiÃ¨res sont allumÃ©es ou Ã©teintes, Ã©tat de la batterie de mon casque, mon tÃ©lÃ©phone et mon pc, suivi de ma consommation Ã©lectriqueâ€¦
*   **DerniÃ¨res notifications** manquÃ©es
*   **Photos alÃ©atoires** parmi mes prÃ©fÃ©rÃ©es (mÃªme si lâ€™Ã©cran est en noir et blanc)
*   **To-do list**
*   **Prochains Ã©vÃ¨nements** de mon calendrier
*   â€¦

En lâ€™occurrence, ma copine mâ€™a suggÃ©rÃ© dâ€™intÃ©grer Ã  lâ€™interface un petit cadre pour un message quâ€™elle pourrait personnaliser. Ã‡a me semble Ãªtre une bonne idÃ©e et Ã§a ne demande pas trop de temps Ã  faire donc je me lance !

La solution la plus simple et Ã©vidente, câ€™est coder une petite API toute simple avec laquelle la liseuse pourra interagir, et un site pour Ã©crire le message.

<Figure 
  src="/images/kobo-root/architecture.png" 
  caption="Architecture du projet : une API Next.js fait le lien entre l'interface de gestion et la liseuse."
  width="70%"
  align="center"
/>

Pour Ã§a je me tourne naturellement vers ma stack habituelle : Next.js et Vercel. Ã‡a me permet de dÃ©velopper rapidement Ã  la fois le site et lâ€™api, et de lâ€™hÃ©berger en seulement un clic gratuitement. De plus, grÃ¢ce au service KV Storage de Vercel pas besoin dâ€™hÃ©berger une grosse base de donnÃ©e !

Tant que jâ€™y suis pour garder un historique des messages, je setup un webhook simple vers un salon discord.

VoilÃ  le rÃ©sultat final :

<Figure 
  src="/images/kobo-root/discord-notification.png" 
  caption="Mini-site permettant dâ€™Ã©crire un message personnalisÃ©"
  width="70%"
  align="center"
/>

Maintenant, plus quâ€™Ã  dÃ©velopper lâ€™interface sur la liseuse. Pour Ã§a, je prototype rapidement le design sur Photoshop, jâ€™exporte tout ce qui est statique dans un fichier PNG et je mesure lâ€™emplacement du texte. Pour Ã©viter que le texte ne dÃ©passe de lâ€™Ã©cran, jâ€™Ã©cris une fonction qui ajoute des retours Ã  la ligne automatiquement.

Je transfÃ¨re tout sur la liseuse, je me fais encore avoir Ã  cause des formats de retour Ã  la ligne, et aprÃ¨s quelques galÃ¨res, jâ€™obtiens le rÃ©sultat suivant :

<Figure 
  src="/images/kobo-root/final-result.png" 
  caption="RÃ©sultat final : la liseuse affiche dÃ©sormais la mÃ©tÃ©o et mes messages personnalisÃ©s."
  width="70%"
  align="center"
/>

Un projet rondement menÃ© :)
